<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
    <title>CMap Summary</title>
    <link href="http://cmap.github.com/cdn/css/main.all.min.css" rel="stylesheet">
</head>
<body data-spy="scroll" data-target=".navbar">
  <!-- navbar -->
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <ul class="nav">
        <li><a href="#home">Home</a></li>
      </ul>
    </div>
  </div>

  <!-- header  -->
  <a id="home"></a>
  <div class='hero-unit'>
    <div class="row-fluid">
    <h1 class="span9">LINCS Data Summary</h1>
    <span class="span3"><a href="http://www.broadinstitute.org/"><img style="max-height=100px;max-width:250px" src="http://coreyflynn.github.com/Bellhop/img/broad_logo.png"></a></span>
    </div>
  </div>

  <div class="row-fluid">
      <div id="top" class="offset1 span10">
        <h2><b>22,412</b> <font color="#636363">reagents-based gene expression signatures</font></h2> 
        <h3><font color="#636363"> (1,142,024 experiments)</font></h3>
      </div>
  </div>

  <div class="row-fluid">
      <div id="cp_summary" class="offset1 span10">
      </div>
  </div>

  <div class="row-fluid">
      <div id="genetic_summary" class="offset1 span10">
      </div>
  </div>

  <div class="row-fluid">
      <div class="offset1 span10">
      </div>
  </div>

  <div class="row-fluid">
      <div id="top" class="offset1 span10">
        <h2><b>15</b> <font color="#636363"> cellular contexts</font></h2>
      </div>
  </div>

  <div class="row-fluid">
      <div id="cell_lines" class="offset1 span10">
      </div>
  </div>

  <div class="row-fluid">
      <div id="primaries" class="offset1 span10">
      </div>
  </div>

  <div class="row-fluid">
      <div class="offset1 span10">
      </div>
  </div>

  <div class="row-fluid" id="loading_container">
        <div class="offset1 span10">
            <img src="http://coreyflynn.github.com/Bellhop/img/ajax-loader.gif">
            <p class="span11 lead">Loading Reagents...</p>
        </div>
    </div>

  <div class="row-fluid">
      <div id="listing" class="offset1 span10">
      </div>
  </div>
</body>

<script src="http://cmap.github.com/cdn/js/main.all.min.js"></script>
<script src="collapse_panel.js"></script>
<script src="jQueryRotateCompressed.2.2.js"></script>
<script type="text/javascript">
  drugs_cp = new Collapse_Panel({
    div_target: "#cp_summary",
    text: '<b>16,425 </b><font color="#636363">Chemical Reagents</font>',
    image:"http://coreyflynn.github.com/Bellhop/img/CP_small.png",
    panels:[
      new Graph_Split_Text_Panel({image:"",text1:'1,456',text2:'<font color="#636363">FDA Approved Drugs</font>',style:"background-color:#dbdbdb"}),
      new Graph_Split_Text_Panel({image:"",text1:'4,212',text2:'<font color="#636363">Bioactive Tool Compounds</font>',style:"background-color:#dbdbdb"}),
      new Graph_Split_Text_Panel({image:"",text1:'912',text2:'<font color="#636363">Novel NIH MLPCN Hits</font>',style:"background-color:#dbdbdb"}),
      new Graph_Split_Text_Panel({image:"",text1:'9,845',text2:'<font color="#636363">Broad DOS Primary Screening Compounds</font>',style:"background-color:#dbdbdb"}),
    ]});

  genetics_cp = new Collapse_Panel({
    div_target: "#genetic_summary",
    text: '<b>5,806 </b><font color="#636363">Genetic Reagents</font>',
    image:"http://coreyflynn.github.com/Bellhop/img/variant.png",
    image_max: 80,
    panels:[
      new Split_Text_Panel({image:"",text1:'3,566',text2:'<font color="#636363">Loss of Function Reagents</font>',style:"background-color:#dbdbdb"}),
      new Split_Text_Panel({image:"",text1:'2,112',text2:'<font color="#636363">Gain of Function Reagents</font>',style:"background-color:#dbdbdb"}),
      new Split_Text_Panel({image:"",text1:'128',text2:'<font color="#636363">Genetic Variants of 35 Genes</font>',style:"background-color:#dbdbdb"}),
    ]});

  
  var cell_lines_columns = [{id: "cell_id", name: "Cell Line", field: "cell_id"},{id: "lineage", name: "Lineage", field: "lineage"}];
  var cell_line_data = [{cell_id:"MCF7",lineage:"breast"},{cell_id:"PC3",lineage:"prostate"},{cell_id:"A549",lineage:"lung"},{cell_id:"A375",lineage:"melanoma"},{cell_id:"HepG2",lineage:"liver carcinoma"},{cell_id:"VCaP",lineage:"prostae"},{cell_id:"HCC515",lineage:"lung"},{cell_id:"HT29",lineage:"colon"},{cell_id:"HA1E",lineage:"kidney epithelial"},{cell_id:"HEK293T",lineage:"embrionic kidney"}];
  cell_lines_cp = new Collapse_Panel({
    div_target: "#cell_lines",
    text: '10 <font color="#636363">Cancer Cell Lines</font>',
    image:"http://coreyflynn.github.com/Bellhop/img/cell_line.png",
    panels:[
      new List_Panel({style:"background-color:#dbdbdb",grid_columns:cell_lines_columns,grid_data:cell_line_data,grid_height:273}),
    ]});

  var primaries_data = [{cell_id:"ASC",lineage:"adipocyte"},{cell_id:"SKL",lineage:"skeletal myocyte"},{cell_id:"PHH",lineage:"hepatocyte"},{cell_id:"NPC",lineage:"iPS derived neural progenitor"},{cell_id:"NEU",lineage:"terminally differentiated neuron"}];
  primaries_cp = new Collapse_Panel({
    div_target: "#primaries",
    text: '5 <font color="#636363">Primary Cell Types</font>',
    image:"http://coreyflynn.github.com/Bellhop/img/brain.png",
    panels:[
      new List_Panel({style:"background-color:#dbdbdb",grid_columns:cell_lines_columns,grid_data:primaries_data,grid_height:150}),
    ]});

  // create the reagents listing collapse panel
  var reagents_grid_columns = [
      {id: "pert_iname", name: "Reagent Name", field: "pert_iname"},
      {id: "pert_type", name: "Reagent Type", field: "pert_type"},
      {id: "num_cell", name: "Cell Lines", field: "num_cell"},
      {id: "num_inst", name: "Experiments", field: "num_inst"}
    ];

    // build the reagents listing data table
    var reagents_grid_object = {};
    var reagents_grid_data = [];
    var reagents_autocomplete_data = [];
    var pert_types = [];
    var pertinfo = "http://107.20.184.64:8080/api/v1.2/pertinfo?callback=?"
    $.getJSON(pertinfo,{q:'{"pert_iname":{"$nin":["-666.0","-666"]}}',
              f:'{"pert_iname":1,"pert_type":1,"num_inst":1,"cell_id":1}',
              l:0,
              s:'{"pert_iname":1}'},
              function(response){
        
        response.forEach(function(element,index,array){
            var unique_key = element.pert_iname + element.pert_type;
            if (reagents_grid_object.hasOwnProperty(unique_key)){
              reagents_grid_object[unique_key].num_inst += element.num_inst;
              reagents_grid_object[unique_key].num_cell += element.cell_id.length;
            }else{
              reagents_grid_object[unique_key] = {
                pert_iname:element.pert_iname,
                pert_type:element.pert_type,
                num_cell:element.cell_id.length,
                num_inst:element.num_inst,

              };
            }
            if (pert_types.indexOf(reagents_autocomplete_data.iname) == -1){
              reagents_autocomplete_data.push(element.pert_iname);
            }
            if (pert_types.indexOf(element.pert_type) == -1){
              pert_types.push(element.pert_type);
              reagents_autocomplete_data.push(element.pert_type);
            }
        });

      reagents_grid_data = _.toArray(reagents_grid_object);
      reagents_autocomplete_data = _.uniq(reagents_autocomplete_data);
      $('#search').typeahead({source: reagents_autocomplete_data});

    // typeahead options for reagents search table
    reagents_grid_filter_columns = ["pert_iname","pert_type"];
    reagents_typeahead_options = {source: reagents_autocomplete_data,
                                  highlighter: function(item){
                                    if (pert_types.indexOf(item) != -1){
                                      return '<div><span class="label label-important">Pert Type</span>  ' + item  +  '</div>';
                                    }
                                    return '<div><span class="label">Reagent Name</span>  ' + item  +  '</div>';
                                    }
                                  };

  listing_cp = new Collapse_Panel({
    div_target: "#listing",
    text: '<font color="#636363">List of Reagents</font>',
    image:"http://coreyflynn.github.com/Bellhop/img/list.png",
    panels:[
      new List_Search_Panel({image:"",
                             text:"Place holder for reagent table",
                             placeholder_text:"Search Reagents",
                             style:"background-color:#dbdbdb",
                             grid_columns:reagents_grid_columns,
                             grid_data:reagents_grid_data,
                             autocompete_data:reagents_autocomplete_data,
                             typeahead_options:reagents_typeahead_options,
                             grid_filter_columns:reagents_grid_filter_columns
                           }),
    ]});
  listing_cp.expand(0);
  $("#loading_container").hide();
  });

</script>
</html>